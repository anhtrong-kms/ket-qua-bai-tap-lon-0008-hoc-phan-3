<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cổng Báo Kết Quả Đánh Giá</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#fff; --muted:#6b7280; --text:#111827; --line:#e5e7eb; --brand:#2563eb; --ok:#16a34a; --warn:#d97706;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:5;background:rgba(255,255,255,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
    .wrap{max-width:1120px;margin:0 auto;padding:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:40px;height:40px;border-radius:12px;background:var(--brand);color:#fff;display:grid;place-items:center;font-weight:700}
    .badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);padding:4px 8px;border-radius:999px;font-size:12px;background:#f9fafb;color:#111}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer}
    .btn:hover{background:#f9fafb}

    main{padding:24px 16px}
    .grid{display:grid;gap:16px}
    @media(min-width:768px){.grid.two{grid-template-columns:1fr 1fr}}

    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 1px 0 rgba(0,0,0,.02)}
    .card-hd{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--line);background:#f9fafb;border-radius:16px 16px 0 0}
    .card-tt{font-weight:600}
    .card-ds{font-size:14px;color:var(--muted)}
    .card-bd{padding:16px}

    .info-row{display:flex;gap:12px;font-size:14px;margin:8px 0}
    .info-l{width:180px;color:var(--muted)}
    .info-v{font-weight:600}

    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{padding:12px;border-bottom:1px solid var(--line);text-align:left;vertical-align:top}
    th{font-size:14px;color:#374151;background:#f9fafb}
    tbody tr:hover{background:#fafafa}

    .status{display:inline-flex;align-items:center;padding:4px 10px;border-radius:999px;border:1px solid}
    .status.gray{background:#f3f4f6;border-color:#e5e7eb;color:#374151}
    .status.green{background:#ecfdf5;border-color:#bbf7d0;color:#047857}
    .status.amber{background:#fffbeb;border-color:#fde68a;color:#92400e}

    .field{width:100%;padding:8px 10px;border:1px solid var(--line);border-radius:8px}
    .foot{display:flex;gap:12px;justify-content:flex-end}

    .toolbar{display:flex;gap:8px;align-items:center}

    /* Print */
    @media print{
      header,.no-print{display:none !important}
      main{padding:0}
      .card{box-shadow:none}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <div class="brand">
        <div class="logo">EV</div>
        <div>
          <div style="font-weight:600">Cổng Báo Kết Quả Đánh Giá</div>
          <div style="font-size:12px;color:var(--muted)" id="course-sub">Bài tập lớn</div>
        </div>
      </div>
      <div class="toolbar">
        <span class="badge" id="badge-date">—</span>
        <button class="btn" onclick="window.print()">In / Xuất PDF</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- VIEW: OVERVIEW -->
    <section id="view-overview" class="grid">
      <div class="card">
        <div class="card-hd">
          <div>
            <div class="card-tt">Thông tin lớp</div>
            <div class="card-ds">Tổng quan lớp và học phần đánh giá</div>
          </div>
          <span class="status green" id="class-status">Đang diễn ra</span>
        </div>
        <div class="card-bd">
          <div class="grid two">
            <div class="info-row"><div class="info-l">Mã lớp</div><div class="info-v" id="maLop">—</div></div>
            <div class="info-row"><div class="info-l">Thời gian học</div><div class="info-v" id="thoiGianHoc">—</div></div>
            <div class="info-row"><div class="info-l">Môn học</div><div class="info-v" id="monHoc">—</div></div>
            <div class="info-row"><div class="info-l">Tên giáo viên</div><div class="info-v" id="tenGiaoVien">—</div></div>
            <div class="info-row"><div class="info-l">Học phần đánh giá</div><div class="info-v" id="hocPhan">—</div></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-hd">
          <div>
            <div class="card-tt">Tổng quan nhóm</div>
            <div class="card-ds">Bấm vào <b>Mã nhóm</b> để xem trang chi tiết chấm điểm</div>
          </div>
        </div>
        <div class="card-bd">
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Mã nhóm</th>
                  <th>Mã bài nhóm</th>
                  <th>Thành viên</th>
                  <th>Điểm (TB)</th>
                  <th>Trạng thái</th>
                  <th>Hành động</th>
                </tr>
              </thead>
              <tbody id="groups-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- VIEW: DETAIL -->
    <section id="view-detail" class="grid" style="display:none">
      <div class="no-print">
        <button class="btn" onclick="App.backToList()">← Quay lại tổng quan</button>
      </div>

      <div class="card">
        <div class="card-hd">
          <div>
            <div class="card-tt" id="detail-title">Chi tiết kết quả – Nhóm</div>
            <div class="card-ds" id="detail-desc">Mẫu theo phiếu đánh giá</div>
          </div>
          <span class="status gray" id="detail-status">Chưa chấm</span>
        </div>
        <div class="card-bd">
          <div class="grid two">
            <div class="info-row"><div class="info-l">Mã lớp</div><div class="info-v" id="dt-maLop">—</div></div>
            <div class="info-row"><div class="info-l">Mã bài nhóm</div><div class="info-v" id="dt-maBai">—</div></div>
            <div class="info-row"><div class="info-l">Đề tài trình bày</div><div class="info-v" id="dt-deTai">—</div></div>
            <div class="info-row"><div class="info-l">Thành viên</div><div class="info-v" id="dt-tv">—</div></div>
          </div>
          <div style="margin-top:6px;font-size:12px;color:var(--muted)">Mẹo: Dùng Ctrl/Cmd + P để xuất PDF trang chi tiết.</div>
        </div>
      </div>

      <!-- BẢNG I -->
      <div class="card">
        <div class="card-hd"><div class="card-tt">BẢNG I – Đánh giá đề tài nghiên cứu</div><div class="card-ds" id="sumI">Tổng tối đa: —</div></div>
        <div class="card-bd">
          <table>
            <thead>
              <tr>
                <th style="width:48px">#</th>
                <th>Tiêu chí</th>
                <th style="width:90px">ĐTĐ</th>
                <th style="width:130px">ĐĐG (nhập điểm)</th>
                <th>Nhận xét</th>
              </tr>
            </thead>
            <tbody id="tbody-I"></tbody>
          </table>
          <div style="text-align:right;margin-top:10px;color:var(--muted)">Tổng điểm hiện tại: <b id="totalI">0</b></div>
        </div>
      </div>

      <!-- BẢNG II -->
      <div class="card">
        <div class="card-hd"><div class="card-tt">BẢNG II – Đánh giá kiến thức học phần</div><div class="card-ds" id="sumII">Tổng tối đa: —</div></div>
        <div class="card-bd">
          <table>
            <thead>
              <tr>
                <th style="width:48px">#</th>
                <th>Tiêu chí</th>
                <th style="width:90px">ĐTĐ</th>
                <th style="width:130px">ĐĐG (nhập điểm)</th>
                <th>Nhận xét</th>
              </tr>
            </thead>
            <tbody id="tbody-II"></tbody>
          </table>
          <div style="text-align:right;margin-top:10px;color:var(--muted)">Tổng điểm hiện tại: <b id="totalII">0</b></div>
        </div>
      </div>

      <!-- Tổng hợp -->
      <div class="card">
        <div class="card-bd">
          <div class="grid two">
            <div>
              <div style="color:var(--muted);font-size:14px">Tổng BẢNG I (thang 100)</div>
              <div style="font-size:28px;font-weight:700" id="boxI">0</div>
            </div>
            <div>
              <div style="color:var(--muted);font-size:14px">Tổng BẢNG II (thang 100)</div>
              <div style="font-size:28px;font-weight:700" id="boxII">0</div>
            </div>
            <div>
              <div style="color:var(--muted);font-size:14px">Điểm trung bình (thang 10)</div>
              <div style="font-size:28px;font-weight:700" id="boxAvg">—</div>
            </div>
          </div>
          <div class="grid two" style="margin-top:16px">
            <div>
              <label style="font-size:14px;color:var(--muted);display:block;margin-bottom:6px">Nhận xét của giáo viên</label>
              <textarea class="field" id="gv-note" rows="5" placeholder="Nhập nhận xét tổng quan"></textarea>
            </div>
            <div>
              <label style="font-size:14px;color:var(--muted);display:block;margin-bottom:6px">Xác nhận của giáo viên</label>
              <div class="grid two">
                <input class="field" id="gv-name" placeholder="Họ tên" />
                <input class="field" id="gv-sign" placeholder="Chữ ký (ghi tên)" />
              </div>
              <div style="font-size:12px;color:var(--muted);margin-top:6px">Ngày xác nhận: <span id="confirm-date">—</span></div>
            </div>
          </div>
          <div class="foot" style="margin-top:16px">
            <button class="btn" onclick="window.print()">In / Xuất PDF</button>
            <button class="btn" onclick="App.mockSave()" style="background:var(--brand);color:#fff;border-color:transparent">Lưu tạm (demo)</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- DATA JSON: có thể tách ra file data.json và fetch() nếu muốn -->
  <script id="app-data" type="application/json">{
    "ngayThuyetTrinh": "24/08/2025",
    "classInfo": {
      "maLop": "TE-C-PA-1518-2023LTWD-0011",
      "thoiGianHoc": "Chủ nhật — 14:00–16:00",
      "monHoc": "Lập Trình Hướng Đối Tượng",
      "tenGiaoVien": "Nguyễn Anh Trọng",
      "hocPhanDanhGia": "Bài tập lớn OOP"
    },
    "groups": [
      {"id":"001124082501","maBaiNhom":"OOP.002","thanhVien":["Trần Nguyên Khang","Phan Tấn Phúc","Nguyễn Nguyên Phú"],"trangThai":"Chưa chấm","diemNhom":null},
      {"id":"001124082502","maBaiNhom":"OOP.001","thanhVien":["Phan Triết An","Dương Tuấn Tú","NaN"],"trangThai":"Chưa chấm","diemNhom":null},
      {"id":"001124082503","maBaiNhom":"OOP.001","thanhVien":["Nguyễn Đinh Thiên Phú","Phù Minh Phúc","Nguyễn Tuấn Kiệt"],"trangThai":"Chưa chấm","diemNhom":null}
    ],
    "bangI": [
      {"id":1,"ten":"Tên đề tài","max":5},
      {"id":2,"ten":"Hiện trạng và vấn đề nghiên cứu","max":10},
      {"id":3,"ten":"Giải pháp và phương pháp nghiên cứu","max":15},
      {"id":4,"ten":"Thiết kế nghiên cứu","max":10},
      {"id":5,"ten":"Thu thập và xử lý dữ liệu","max":15},
      {"id":6,"ten":"Phân tích dữ liệu và kết quả nghiên cứu","max":15},
      {"id":7,"ten":"Minh chứng cho các hoạt động nghiên cứu","max":15},
      {"id":8,"ten":"Trình bày báo cáo","max":15}
    ],
    "bangII": [
      {"id":1,"ten":"Xây dựng lớp và đối tượng","max":10},
      {"id":2,"ten":"Tính đóng gói (Encapsulation)","max":10},
      {"id":3,"ten":"Tính kế thừa (Inheritance)","max":10},
      {"id":4,"ten":"Tính đa hình (Polymorphism)","max":10},
      {"id":5,"ten":"Tính trừu tượng (Abstraction)","max":10},
      {"id":6,"ten":"Quản lý lỗi và xử lý ngoại lệ","max":10},
      {"id":7,"ten":"Tối ưu & nguyên tắc lập trình tốt","max":10},
      {"id":8,"ten":"Hiệu quả của chương trình trong đề tài","max":10},
      {"id":9,"ten":"Kiểm thử và đánh giá chương trình","max":10},
      {"id":10,"ten":"Tài liệu và hướng dẫn sử dụng","max":10}
    ]
  }</script>

  <script>
    const App = (()=>{
      const $ = (sel)=>document.querySelector(sel);
      const $$ = (sel)=>Array.from(document.querySelectorAll(sel));
      const data = JSON.parse(document.getElementById('app-data').textContent);

      const state = {
        selectedGroup: null,
        scoresI: {},
        scoresII: {}
      };

      function fmtMembers(arr){return arr.join(', ')}
      function clamp(v, min, max){return Math.max(min, Math.min(v, max))}

      function loadClassInfo(){
        $('#maLop').textContent = data.classInfo.maLop;
        $('#thoiGianHoc').textContent = data.classInfo.thoiGianHoc;
        $('#monHoc').textContent = data.classInfo.monHoc;
        $('#tenGiaoVien').textContent = data.classInfo.tenGiaoVien;
        $('#hocPhan').textContent = data.classInfo.hocPhanDanhGia;
        $('#course-sub').textContent = `Bài tập lớn – ${data.classInfo.monHoc}`;
        $('#badge-date').textContent = data.ngayThuyetTrinh;
      }

      function renderGroups(){
        const tbody = $('#groups-tbody');
        tbody.innerHTML = '';
        data.groups.forEach(g=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><button class="link" data-id="${g.id}" style="color:#2563eb;background:none;border:none;padding:0;cursor:pointer">${g.id}</button></td>
            <td>${g.maBaiNhom}</td>
            <td>${fmtMembers(g.thanhVien)}</td>
            <td>${g.diemNhom ?? '—'}</td>
            <td><span class="status ${g.trangThai==='Đã chấm'?'green':'amber'}">${g.trangThai}</span></td>
            <td><button class="btn" data-id="${g.id}">Chấm điểm</button></td>
          `;
          tbody.appendChild(tr);
        });

        // events
        $$('button[data-id]').forEach(btn=>{
          btn.addEventListener('click', (e)=> openDetail(e.currentTarget.getAttribute('data-id')) );
        });
      }

      function openDetail(id){
        state.selectedGroup = id; state.scoresI = {}; state.scoresII = {};
        const g = data.groups.find(x=>x.id===id);
        if(!g) return;

        // header/detail
        $('#view-overview').style.display='none';
        $('#view-detail').style.display='grid';
        $('#detail-title').textContent = `Chi tiết kết quả – Nhóm ${g.id}`;
        $('#detail-desc').textContent = `Ngày thuyết trình: ${data.ngayThuyetTrinh}`;
        $('#dt-maLop').textContent = data.classInfo.maLop;
        $('#dt-maBai').textContent = g.maBaiNhom;
        $('#dt-deTai').textContent = g.maBaiNhom;
        $('#dt-tv').textContent = fmtMembers(g.thanhVien);
        $('#confirm-date').textContent = data.ngayThuyetTrinh;
        $('#detail-status').className = 'status amber';
        $('#detail-status').textContent = 'Đang chấm';

        // tables
        buildScoreTable('I', data.bangI);
        buildScoreTable('II', data.bangII);
        updateTotals();
      }

      function buildScoreTable(key, items){
        const tbody = document.getElementById(`tbody-${key}`);
        tbody.innerHTML = '';
        const sumMax = items.reduce((s,it)=>s+it.max,0);
        document.getElementById(key==='I'?'sumI':'sumII').textContent = `Tổng tối đa: ${sumMax} điểm`;

        items.forEach((it, idx)=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${idx+1}</td>
            <td style="font-weight:600">${it.ten}</td>
            <td>${it.max}</td>
            <td>
              <input type="number" class="field" style="max-width:120px" placeholder="0–${it.max}" data-key="${key}" data-id="${it.id}">
            </td>
            <td>
              <textarea class="field" rows="1" placeholder="Ghi nhận xét (tuỳ chọn)"></textarea>
            </td>
          `;
          tbody.appendChild(tr);
        });

        // input events
        $$(`#tbody-${key} input[type=number]`).forEach(inp=>{
          inp.addEventListener('input', (e)=>{
            const k = e.target.getAttribute('data-key');
            const id = Number(e.target.getAttribute('data-id'));
            const max = items.find(x=>x.id===id)?.max || 0;
            const val = e.target.value === '' ? '' : clamp(Number(e.target.value), 0, max);
            if(e.target.value!=='' && String(val)!==e.target.value) e.target.value = val;
            if(k==='I'){ state.scoresI[id] = e.target.value===''? '': val; }
            else { state.scoresII[id] = e.target.value===''? '': val; }
            updateTotals();
          });
        });
      }

      function sumScores(dict){
        return Object.values(dict).reduce((s,v)=> s + (Number(v)||0), 0);
      }

      function updateTotals(){
        const tI = sumScores(state.scoresI);
        const tII = sumScores(state.scoresII);
        document.getElementById('totalI').textContent = tI;
        document.getElementById('totalII').textContent = tII;
        document.getElementById('boxI').textContent = tI;
        document.getElementById('boxII').textContent = tII;
        const avg100 = (tI + tII) / 2; // trung bình 2 bảng (thang 100)
        const avg10 = isNaN(avg100) ? '—' : Math.round((avg100/10)*10)/10; // quy về thang 10
        document.getElementById('boxAvg').textContent = isNaN(avg100)? '—' : avg10;
      }

      function backToList(){
        $('#view-detail').style.display='none';
        $('#view-overview').style.display='grid';
      }

      function mockSave(){
        const payload = {
          groupId: state.selectedGroup,
          scoresI: state.scoresI,
          scoresII: state.scoresII,
          note: $('#gv-note').value,
          teacher: $('#gv-name').value,
          sign: $('#gv-sign').value,
          date: data.ngayThuyetTrinh,
          totals: { I: sumScores(state.scoresI), II: sumScores(state.scoresII) }
        };
        alert('Đã lưu tạm (demo):\n' + JSON.stringify(payload, null, 2));
      }

      function init(){
        loadClassInfo();
        renderGroups();
      }

      return { init, openDetail, backToList, mockSave };
    })();

    window.App = App; // tiện debug
    window.addEventListener('DOMContentLoaded', App.init);
  </script>
</body>
</html>